<script>
  const canvas = document.getElementById("graCanvas");
  const ctx = canvas.getContext("2d");

  let isDrawing = false;
  let path = [];
  let pilka = { x: 200, y: 550, r: 10, flying: false, index: 0 };
  let punkty = 0;

  let kosz = { x: 160, y: 100, w: 80, h: 20, dx: 0 };

  const wyborPoziomu = document.getElementById("wyborPoziomu");

  function ustawTrudnosc() {
    const poziom = wyborPoziomu.value;
    if (poziom === "latwy") {
      kosz.dx = 0;
    } else if (poziom === "sredni") {
      kosz.dx = 1.2;
    } else if (poziom === "trudny") {
      kosz.dx = 2.5;
    }
  }

  wyborPoziomu.addEventListener("change", ustawTrudnosc);
  ustawTrudnosc();

  function drawKosz() {
    // ... (tw贸j kod kosza si nie zmienia)
  }

  function drawPilka() {
    // ... (tw贸j kod piki si nie zmienia)
  }

  function drawPath() {
    // ... (tw贸j kod rysowania si nie zmienia)
  }

  canvas.addEventListener("mousedown", (e) => {
    if (pilka.flying) return;
    path = [];
    isDrawing = true;
    const rect = canvas.getBoundingClientRect();
    path.push({ x: e.clientX - rect.left, y: e.clientY - rect.top });
  });

  canvas.addEventListener("mousemove", (e) => {
    if (!isDrawing) return;
    const rect = canvas.getBoundingClientRect();
    path.push({ x: e.clientX - rect.left, y: e.clientY - rect.top });
  });

  canvas.addEventListener("mouseup", () => {
    if (path.length > 1) {
      isDrawing = false;
      pilka.flying = true;
      pilka.index = 0;
    }
  });

  //  DODANE: Obsuga dotyku (dziaa na telefonie!)
  canvas.addEventListener("touchstart", e => {
    if (pilka.flying) return;
    path = [];
    isDrawing = true;
    const rect = canvas.getBoundingClientRect();
    const t = e.touches[0];
    path.push({ x: t.clientX - rect.left, y: t.clientY - rect.top });
    e.preventDefault();
  }, { passive: false });

  canvas.addEventListener("touchmove", e => {
    if (!isDrawing) return;
    const rect = canvas.getBoundingClientRect();
    const t = e.touches[0];
    path.push({ x: t.clientX - rect.left, y: t.clientY - rect.top });
    e.preventDefault();
  }, { passive: false });

  canvas.addEventListener("touchend", e => {
    if (path.length > 1) {
      isDrawing = false;
      pilka.flying = true;
      pilka.index = 0;
    }
    e.preventDefault();
  }, { passive: false });

  function sprawdzCzyWpadla() {
    // ... (tw贸j kod bez zmian)
  }

  function update() {
    // ... (tw贸j kod bez zmian)
  }

  update();
</script>
